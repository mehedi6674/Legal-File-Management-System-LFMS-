{% extends "base.html" %}

{% block title %}Edit User - LFMS{% endblock %}

{% block content %}
  <div class="container">
    <div class="card">
      <div class="card-header">
        <h4 class="mb-0">Edit User: {{ user.name }}</h4>
      </div>
      <div class="card-body p-4">

      <!-- Lock and Reset Password buttons ABOVE the form -->
      <div class="action-buttons mb-4">
        {% if user.is_approved == 0 %}
          <form method="POST" action="{{ url_for('unlock_user', user_id=user.user_id) }}" class="d-inline">
            <button type="submit" class="btn btn-success" onclick="return confirm('Unlock this user?');">
              <i class="bi bi-unlock-fill"></i> Unlock User
            </button>
          </form>
        {% else %}
          <form method="POST" action="{{ url_for('lock_user', user_id=user.user_id) }}" class="d-inline">
            <button type="submit" class="btn btn-danger" onclick="return confirm('Lock this user?');">
              <i class="bi bi-lock-fill"></i> Lock User
            </button>
          </form>
        {% endif %}

        <form method="POST" action="{{ url_for('reset_password', user_id=user.user_id) }}" class="d-inline" onsubmit="return confirm('Are you sure you want to reset the password for this user? A new password will be sent to their email.');">
          <button type="submit" class="btn btn-info">
            <i class="bi bi-arrow-repeat"></i> Reset Password
          </button>
        </form>
      </div>

      <form method="POST" action="{{ url_for('edit_user', user_id=user.user_id) }}">

        <!-- Removed Mobile Number and Office ID fields -->

        <div class="mb-3">
          <label for="name" class="form-label">Full Name</label>
          <input type="text" class="form-control" id="name" name="name" value="{{ user.name }}" required />
        </div>

        <div class="mb-3">
          <label for="designation" class="form-label">Designation</label>
          <select class="form-select" id="designation" name="designation" required>
                <option value="">Select Designation</option>
                <option value="Executive">Executive</option>
                <option value="Sr. Executive">Sr. Executive</option>
                <option value="Assistant Manager">Assistant Manager</option>
                <option value="Deputy Manager">Deputy Manager</option>
                <option value="Manager">Manager</option>
                <option value="Senior Manager">Senior Manager</option>
                <option value="Assistant General Manager">Assistant General Manager</option>
                <option value="Deputy General Manager">Deputy General Manager</option>
                <option value="Executive Director">Executive Director</option>
                <option value="Director">Director</option>
                <option value="CFO">CFO</option>
                <option value="CEO">CEO</option>

          </select>
        </div>

        <div class="mb-3">
          <label for="department" class="form-label">Department</label>
          <select id="department" name="department" class="form-select">
            <option value="" disabled selected>Select Department</option>
            <option>Finance</option>
                <option>Health & Safety</option>
                <option>HR & Admin</option>
                <option>IT</option>
                <option>Logistics & Operation</option>
                <option>Legal & Compliance</option>
                <option>Procurement</option>
                <option>Sales & Marketing</option>
                <option>Plant Operations</option>
                <option>Others</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="supervisor_name" class="form-label">Supervisor Name</label>
          <input type="text" class="form-control" id="supervisor_name" name="supervisor_name" value="{{ user.supervisor_name }}" />
        </div>

        <div class="mb-3">
          <label for="supervisor_email" class="form-label">Supervisor Email</label>
          <input type="email" class="form-control" id="supervisor_email" name="supervisor_email" value="{{ user.supervisor_email }}" />
        </div>

        <div class="mb-3">
          <label for="company" class="form-label">Company</label>
          <input type="text" class="form-control" id="company" name="company" value="{{ user.company }}" />
        </div>

        <div class="mb-3">
          <label for="location" class="form-label">Location</label>
          <input type="text" class="form-control" id="location" name="location" value="{{ user.location }}" />
        </div>

        <div class="mb-3">
          <label for="email" class="form-label">Email Address</label>
          <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required />
        </div>

        <div class="mb-3">
          <label for="is_approved" class="form-label">Approval Status</label>
          <select id="is_approved" name="is_approved" class="form-select">
            <option value="0" {% if user.is_approved == 0 %}selected{% endif %}>Not Approved</option>
            <option value="1" {% if user.is_approved == 1 %}selected{% endif %}>Approved</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="role" class="form-label">Role</label>
          <select id="role" name="role" class="form-select" required>
            <option value="">-- Select Role --</option>
            <option value="user" {% if user.role == 'user' %}selected{% endif %}>User</option>
            <option value="supervisor" {% if user.role == 'supervisor' %}selected{% endif %}>Supervisor</option>
            <option value="ceo" {% if user.role == 'ceo' %}selected{% endif %}>CEO</option>
            <option value="legal_team" {% if user.role == 'legal_team' %}selected{% endif %}>Legal Team</option>
            <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Admin</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="view_access" class="form-label">View Access</label>
          <select id="view_access" name="view_access" class="form-select">
            <option value="No" {% if user.view_access == 'No' %}selected{% endif %}>No</option>
            <option value="Yes" {% if user.view_access == 'Yes' %}selected{% endif %}>Yes</option>
          </select>
        </div>

        <div class="mt-4">
          <button type="submit" class="btn btn-primary">Save Changes</button>
          <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>
  </div>
{% endblock %}
