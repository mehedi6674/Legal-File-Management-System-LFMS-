{% extends "base.html" %}

{% block title %}Register - LFMS{% endblock %}

{% block content %}
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-10 col-lg-8">
        <div class="card p-4 p-md-5">
          <div class="card-header text-center">
            <h5 class="mb-0">User Registration</h5>
          </div>
          <div class="card-body">

          <form method="POST" action="{{ url_for('register') }}" class="needs-validation" novalidate>
            <div class="row mb-3">
  <!-- First Name -->
  <div class="col-md-6">
    <label for="first_name" class="form-label">First Name</label>
    <input type="text" class="form-control" id="first_name" name="first_name" required />
    <div class="invalid-feedback">
      Please enter your first name.
    </div>
  </div>

  <!-- Last Name -->
  <div class="col-md-6 mb-3">
    <label for="last_name" class="form-label">Last Name</label>
    <input type="text" class="form-control" id="last_name" name="last_name" required />
    <div class="invalid-feedback">
      Please enter your last name.
    </div>
  </div>

            <div class="mb-3">
              <label for="email" class="form-label">Email Address</label>
              <input type="email" class="form-control" id="email" name="email" required />
              <div class="invalid-feedback">
                Please enter a valid email address.
              </div>
            </div>
<!-- Hidden field that will hold the combined name -->
<input type="hidden" id="name" name="name" />

            <div class="row">
            <div class="col-md-6 mb-3">
              <label for="designation" class="form-label">Designation</label>
              <select class="form-select" id="designation" name="designation" required>
                <option value="">Select Designation</option>
                <option value="Executive">Executive</option>
                <option value="Sr. Executive">Sr. Executive</option>
                <option value="Assistant Manager">Assistant Manager</option>
                <option value="Deputy Manager">Deputy Manager</option>
                <option value="Manager">Manager</option>
                <option value="Senior Manager">Senior Manager</option>
                <option value="Assistant General Manager">Assistant General Manager</option>
                <option value="Deputy General Manager">Deputy General Manager</option>
                <option value="Executive Director">Executive Director</option>
                <option value="Director">Director</option>
                <option value="CFO">CFO</option>
                <option value="CEO">CEO</option>
              </select>
              <div class="invalid-feedback">
                Please select your designation.
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label for="department" class="form-label">Department</label>
              <select class="form-select" id="department" name="department" required>
                <option value="" disabled selected>Select your department</option>
                <option>Finance</option>
                <option>Health & Safety</option>
                <option>HR & Admin</option>
                <option>IT</option>
                <option>Logistics & Operation</option>
                <option>Legal & Compliance</option>
                <option>Procurement</option>
                <option>Sales & Marketing</option>
                <option>Plant Operations</option>
                
              </select>
              <div class="invalid-feedback">
                Please select your department.
              </div>
            </div>
            </div>

            <!-- Supervisor Dropdown -->
            <div class="mb-3">
              <label for="supervisor_name" class="form-label">Supervisor Name</label>
              <select class="form-select" id="supervisor_name" name="supervisor_name" onchange="setSupervisorEmail(this)" required>
                <option value="">Select Supervisor</option>
                {% for supervisor in supervisors %}
                  <option value="{{ supervisor.name }}" data-email="{{ supervisor.email }}">{{ supervisor.name }}</option>
                {% endfor %}
              </select>
              <div class="invalid-feedback">Please select your supervisor.</div>
            </div>

            <!-- Supervisor Email Auto-filled -->
            <div class="mb-3">
              
              <input type="hidden" class="form-control" id="supervisor_email" name="supervisor_email" readonly required />
              
            </div>

            <div class="row">
            <div class="col-md-6 mb-3">
              <label for="company" class="form-label">Company</label>
              <select class="form-select" id="company" name="company" required>
                <option value="" disabled selected>Select your company</option>
                <option>Petromax LPG LTD.</option>
                <option>Petromax Cylinder LTD.</option>
              </select>
              <div class="invalid-feedback">
                Please select your company.
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label for="location" class="form-label">Location</label>
              <select class="form-select" id="location" name="location" required>
                <option value="" disabled selected>Select your location</option>
                <option>Head Office</option>
                <option>Rupganj Plant</option>
                <option>Mongla Plant</option>
                <option>Tangail Plant</option>
                <option>DD & RDC</option>
              </select>
              <div class="invalid-feedback">
                Please select your location.
              </div>
            </div>
            </div>

            

            <div class="mb-3">
              <input type="hidden" id="password" name="password" />
            </div>

            <button type="submit" class="btn btn-primary w-100 mt-3">Register</button>
          </form>

          <p class="mt-3 text-center">
            Already have an account? <a href="{{ url_for('login') }}">Login here</a>.
          </p>
        </div>
      </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Combine first and last name into a single 'name' field on form submission
    document.querySelector("form").addEventListener("submit", function () {
      let first = document.getElementById("first_name").value.trim();
      let last = document.getElementById("last_name").value.trim();
      document.getElementById("name").value = first + " " + last;
    });

    // Bootstrap 5 form validation
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  });

  // Supervisor Email Setter - must be global for the onchange attribute
  function setSupervisorEmail(select) {
    const selectedOption = select.options[select.selectedIndex];
    const email = selectedOption ? selectedOption.getAttribute('data-email') : '';
    document.getElementById('supervisor_email').value = email || '';
  }
</script>
{% endblock %}
