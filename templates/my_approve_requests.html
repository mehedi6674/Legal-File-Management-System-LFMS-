{% extends "base.html" %}

{% block title %}My Approved Requests - LFMS{% endblock %}

{% block content %}
<div class="container-fluid">
  <a href="{{ url_for('dashboard') }}" class="back-button"><i class="bi bi-arrow-left"></i> Back to Dashboard</a>
  <h2 class="mb-3 text-primary">
    {% if role == 'supervisor' %}
      My Approved Requests (Supervisor)
    {% elif role == 'ceo' %}
      My Approved Requests (CEO)
    {% endif %}
  </h2>
  <p class="text-muted">A history of all requests you have approved.</p>

  <div class="card">
    <div class="card-body">
      {% if requests %}
        <div class="table-responsive">
          <table class="table table-bordered table-hover align-middle">
            <thead class="table-light">
              <tr class="text-center">
                <th>Request No</th>
                <th>Request Title</th>
                <th>Document Type</th>
                <th>Requested By</th>
                <th>Request Date</th>
                <th>Approval Date</th>
                <th>Current Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for req in requests %}
                <tr class="text-center">
                  <td>REQ-{{ req.request_id }}</td>
                  <td>{{ req.request_title }}</td>
                  <td>{{ req.document_type | title }}</td>
                  <td>{{ req.user_name }}</td>
                  <td>{{ req.created_at.strftime('%Y-%m-%d') }}</td>
                  <td>
                    {% if role == 'supervisor' %}
                      {{ req.supervisor_approval_date.strftime('%Y-%m-%d') if req.supervisor_approval_date else '-' }}
                    {% elif role == 'ceo' %}
                      {{ req.ceo_approval_date.strftime('%Y-%m-%d') if req.ceo_approval_date else '-' }}
                    {% endif %}
                  </td>
                  <td>
                    {% if req.status == 'supervisor_approval_pending' %}
                      <span class="badge bg-warning text-dark">Supervisor Pending</span>
                    {% elif req.status == 'ceo_approval_pending' %}
                      <span class="badge bg-warning text-dark">CEO Pending</span>
                    {% elif req.status in ['supervisor_approved', 'ceo_approved', 'legal_feedback_given'] %}
                      <span class="badge bg-info">Legal Team Processing</span>
                    {% elif req.status == 'final_documents_avaiable' %}
                      <span class="badge bg-success">Final Legal Document Available</span>
                    {% elif req.status == 'rejected' %}
                      <span class="badge bg-danger">Rejected</span>
                    {% else %}
                      <span class="badge bg-dark">{{ req.status | title }}</span>
                    {% endif %}
                  </td>
                  <td>
                    <a href="{{ url_for('view_request', request_id=req.request_id) }}" class="btn btn-sm btn-outline-primary">View</a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="text-center text-muted my-5">
          <h4><i class="bi bi-check2-circle"></i> You have not approved any requests yet.</h4>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
